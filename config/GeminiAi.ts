import { GoogleGenerativeAI } from "@google/generative-ai";

const apiKey = process.env.NEXT_PUBLIC_GEMINI_API_KEY;

if (!apiKey) {
  throw new Error("GEMINI_API_KEY environment variable is not set.");
}

const genAI = new GoogleGenerativeAI(apiKey);

const model = genAI.getGenerativeModel({
  model: "gemini-1.5-flash",
});

const generationConfig = {
  temperature: 1,
  topP: 0.95,
  topK: 64,
  maxOutputTokens: 8192,
  responseMimeType: "application/json",
};

export const chatSession = model.startChat({
  generationConfig,
  history: [
    {
      role: "user",
      parts: [{ text: "Mwas, Kijana Mbunifu" }],
    },
    {
      role: "model",
      parts: [
        {
          text: '```json\n{\n  "story_title": "Mwas, Kijana Mbunifu",\n  "cover_image_prompt": "A vibrant illustration of a young African boy, Mwas, with a playful and curious expression. He is surrounded by colorful, whimsical objects representing his inventions: a toy helicopter made of recycled materials, a wind-powered car, and a colorful kite flying high in the sky. The background is a lively African village with mud-brick houses, lush greenery, and a bright, sunny sky.",\n  "chapters": [\n    {\n      "chapter_title": "Mwas na Fikra zake",\n      "chapter_text": "Katika kijiji kidogo kilichojaa miti ya mikuyu na nyumba za udongo, kuliishi kijana mkorofi na mbunifu aitwaye Mwas. Mwas alikuwa na akili timamu na fikra zisizoisha. Alipenda kutafuta njia mpya za kutatua matatizo na kuunda vitu vipya. Alicheza na vitu vya kuchezea alivyotengeneza mwenyewe kutoka kwa vifaa vya taka, akiwa na ndoto kubwa za kuwasaidia watu katika kijiji chake.",\n      "image_prompt": "An illustration of Mwas in his village, surrounded by colorful objects he has made: a toy car, a kite, and a wind-powered windmill made from recycled materials. The background shows his village, with huts made of mud bricks and palm trees swaying gently in the breeze."\n    },\n    {\n      "chapter_title": "Simu ya Mwas",\n      "chapter_text": "Siku moja, Mwas alipata shida kubwa. Mama yake alikuwa mgonjwa na hakukuwa na njia ya kupata daktari kutoka kijijini. Mwas alifikiria sana, akitaka kupata suluhisho. Kisha, akafanya kitu cha ajabu. Alichukua chupa tupu ya soda, waya wa shaba, na kipande cha kitambaa. Akatengeneza kitu kama simu, akijua kwamba sauti inaweza kusafiri kwa waya. Alichukua simu yake ya chupa na kwenda nyumbani kwa jirani yake, mzee Ali, ambaye alijua kuwasiliana na daktari wa kijiji.",\n      "image_prompt": "A close-up illustration of Mwas holding his "phone" made from a soda bottle, copper wire, and cloth. He looks determined, trying to transmit a message. The background shows a mud-brick house and a worried mother inside."\n    },\n    {\n      "chapter_title": "Msaada kutoka Mbali",\n      "chapter_text": "Mzee Ali alimsikiliza Mwas kwa uangalifu. Alielewa shida ya Mwas na akaunganisha simu yake ya chupa na simu nyingine iliyojengwa na waya mrefu. Sauti ya Mwas iliweza kufikia daktari aliyekuwa mbali, na daktari huyo aliahidi kuja kwa haraka iwezekanavyo. Mwas alifurahi sana, akisikia kwamba mama yake atapata msaada.",\n      "image_prompt": "A detailed illustration of Mwas, Mzee Ali, and the other villagers connecting the "phones" with long wires. The illustration should show the village setting with trees and huts in the background. The image should convey a sense of hope and connection."\n    },\n    {\n      "chapter_title": "Utukufu wa Ubunifu",\n      "chapter_text": "Daktari alifika kijijini haraka na akamtibu mama ya Mwas. Mwas alikuwa na furaha kubwa, akisikia kwamba alikuwa ameokoa mama yake kwa akili yake na ubunifu wake. Watu wa kijiji walimsifu Mwas kwa ustadi wake na akili yake ya ajabu. Mwas alijua kwamba ubunifu wake ulikuwa na nguvu ya kusaidia watu wengi.",\n      "image_prompt": "An illustration showing the doctor arriving in the village, with Mwas and his mother standing beside him. The village community is celebrating Mwas\'s ingenuity, and the doctor is praising his skills. The scene should be joyful and celebratory, with bright colors and happy expressions."\n    },\n    {\n      "chapter_title": "Mwas, Mbunifu wa Kijiji",\n      "chapter_text": "Tangu siku hiyo, Mwas aliendelea kuunda vitu vipya na kuboresha maisha ya watu katika kijiji chake. Alijenga matanki ya maji kwa kutumia makopo ya zamani, aliunda taa za sola kwa kutumia chupa za plastiki, na akapanda miti mingi ili kuongeza uzuri wa kijiji chake. Mwas alikuwa mbunifu wa kijiji, akiendeshwa na ndoto ya kuwasaidia wengine kwa kutumia akili yake na mikono yake.",\n      "image_prompt": "A vibrant illustration of Mwas working on new inventions in his village. The image should depict a variety of his creations, such as water tanks made from old cans, solar lights from plastic bottles, and a lush garden with thriving trees. The scene should convey a sense of progress and hope, with a vibrant and joyful atmosphere."\n    }\n  ],\n  "voice_cues": [\n    {\n      "chapter_title": "Mwas na Fikra zake",\n      "chapter_text_with_voice_cues": "Katika kijiji kidogo kilichojaa miti ya mikuyu na nyumba za udongo, [pause] kuliishi kijana mkorofi na mbunifu aitwaye Mwas. [whisper] Mwas alikuwa na akili timamu na fikra zisizoisha. [speak with excitement] Alipenda kutafuta njia mpya za kutatua matatizo na kuunda vitu vipya. [pause] Alicheza na vitu vya kuchezea alivyotengeneza mwenyewe kutoka kwa vifaa vya taka, [speak with a dreamy tone] akiwa na ndoto kubwa za kuwasaidia watu katika kijiji chake."\n    },\n    {\n      "chapter_title": "Simu ya Mwas",\n      "chapter_text_with_voice_cues": "Siku moja, [speak in a concerned tone] Mwas alipata shida kubwa. [pause] Mama yake alikuwa mgonjwa na hakukuwa na njia ya kupata daktari kutoka kijijini. [pause] Mwas alifikiria sana, akitaka kupata suluhisho. [speak slowly and thoughtfully] Kisha, akafanya kitu cha ajabu. [speak with excitement] Alichukua chupa tupu ya soda, waya wa shaba, na kipande cha kitambaa. [pause] Akatengeneza kitu kama simu, akijua kwamba sauti inaweza kusafiri kwa waya. [speak with determination] Alichukua simu yake ya chupa na kwenda nyumbani kwa jirani yake, mzee Ali, ambaye alijua kuwasiliana na daktari wa kijiji."\n    },\n    {\n      "chapter_title": "Msaada kutoka Mbali",\n      "chapter_text_with_voice_cues": "Mzee Ali alimsikiliza Mwas kwa uangalifu. [pause] Alielewa shida ya Mwas na akaunganisha simu yake ya chupa na simu nyingine iliyojengwa na waya mrefu. [speak with a sense of wonder] Sauti ya Mwas iliweza kufikia daktari aliyekuwa mbali, na daktari huyo aliahidi kuja kwa haraka iwezekanavyo. [speak with happiness] Mwas alifurahi sana, akisikia kwamba mama yake atapata msaada."\n    },\n    {\n      "chapter_title": "Utukufu wa Ubunifu",\n      "chapter_text_with_voice_cues": "Daktari alifika kijijini haraka na akamtibu mama ya Mwas. [speak with joy] Mwas alikuwa na furaha kubwa, akisikia kwamba alikuwa ameokoa mama yake kwa akili yake na ubunifu wake. [speak with admiration] Watu wa kijiji walimsifu Mwas kwa ustadi wake na akili yake ya ajabu. [speak with pride] Mwas alijua kwamba ubunifu wake ulikuwa na nguvu ya kusaidia watu wengi."\n    },\n    {\n      "chapter_title": "Mwas, Mbunifu wa Kijiji",\n      "chapter_text_with_voice_cues": "Tangu siku hiyo, [speak with a sense of accomplishment] Mwas aliendelea kuunda vitu vipya na kuboresha maisha ya watu katika kijiji chake. [speak with enthusiasm] Alijenga matanki ya maji kwa kutumia makopo ya zamani, aliunda taa za sola kwa kutumia chupa za plastiki, na akapanda miti mingi ili kuongeza uzuri wa kijiji chake. [speak with a sense of pride] Mwas alikuwa mbunifu wa kijiji, [speak with a sense of purpose] akiendeshwa na ndoto ya kuwasaidia wengine kwa kutumia akili yake na mikono yake."\n    }\n  ]\n}\n```',
        },
      ],
    },
    {
      role: "user",
      parts: [{ text: "Mwas, The creative boy\n" }],
    },
    {
      role: "model",
      parts: [
        {
          text: '```json\n{\n  "story_title": "Mwas, The Creative Boy",\n  "cover_image_prompt": "A vibrant illustration of a young African boy, Mwas, with a playful and curious expression. He is surrounded by colorful, whimsical objects representing his inventions: a toy helicopter made of recycled materials, a wind-powered car, and a colorful kite flying high in the sky. The background is a lively African village with mud-brick houses, lush greenery, and a bright, sunny sky.",\n  "chapters": [\n    {\n      "chapter_title": "Mwas and His Ideas",\n      "chapter_text": "In a small village filled with fig trees and mud-brick houses, lived a mischievous and creative boy named Mwas. Mwas had a bright mind and endless ideas. He loved to find new ways to solve problems and build new things. He played with toys he made himself from scrap materials, dreaming big about helping people in his village.",\n      "image_prompt": "An illustration of Mwas in his village, surrounded by colorful objects he has made: a toy car, a kite, and a wind-powered windmill made from recycled materials. The background shows his village, with huts made of mud bricks and palm trees swaying gently in the breeze."\n    },\n    {\n      "chapter_title": "Mwas\'s Phone",\n      "chapter_text": "One day, Mwas faced a big problem. His mother was sick, and there was no way to reach a doctor from the village. Mwas thought long and hard, wanting to find a solution. Then, he did something amazing. He took an empty soda bottle, some copper wire, and a piece of cloth. He made something like a phone, knowing that sound could travel through wires. He took his bottle phone and went to the home of his neighbor, Old Ali, who knew how to contact the village doctor.",\n      "image_prompt": "A close-up illustration of Mwas holding his "phone" made from a soda bottle, copper wire, and cloth. He looks determined, trying to transmit a message. The background shows a mud-brick house and a worried mother inside."\n    },\n    {\n      "chapter_title": "Help from Afar",\n      "chapter_text": "Old Ali listened to Mwas carefully. He understood Mwas\'s problem and connected his bottle phone to another phone made with a long wire. Mwas\'s voice reached the doctor far away, and the doctor promised to come as quickly as possible. Mwas was overjoyed, knowing his mother would get help.",\n      "image_prompt": "A detailed illustration of Mwas, Old Ali, and the other villagers connecting the "phones" with long wires. The illustration should show the village setting with trees and huts in the background. The image should convey a sense of hope and connection."\n    },\n    {\n      "chapter_title": "The Glory of Creativity",\n      "chapter_text": "The doctor arrived in the village quickly and treated Mwas\'s mother. Mwas was very happy, knowing that he had saved his mother with his intelligence and creativity. The villagers praised Mwas for his skills and his amazing mind. Mwas knew that his creativity had the power to help many people.",\n      "image_prompt": "An illustration showing the doctor arriving in the village, with Mwas and his mother standing beside him. The village community is celebrating Mwas\'s ingenuity, and the doctor is praising his skills. The scene should be joyful and celebratory, with bright colors and happy expressions."\n    },\n    {\n      "chapter_title": "Mwas, the Village Inventor",\n      "chapter_text": "From that day on, Mwas continued to create new things and improve the lives of people in his village. He built water tanks using old cans, made solar lights using plastic bottles, and planted many trees to add beauty to his village. Mwas was the village inventor, driven by the dream of helping others with his mind and his hands.",\n      "image_prompt": "A vibrant illustration of Mwas working on new inventions in his village. The image should depict a variety of his creations, such as water tanks made from old cans, solar lights from plastic bottles, and a lush garden with thriving trees. The scene should convey a sense of progress and hope, with a vibrant and joyful atmosphere."\n    }\n  ],\n  "voice_cues": [\n    {\n      "chapter_title": "Mwas and His Ideas",\n      "chapter_text_with_voice_cues": "In a small village filled with fig trees and mud-brick houses, [pause] lived a mischievous and creative boy named Mwas. [whisper] Mwas had a bright mind and endless ideas. [speak with excitement] He loved to find new ways to solve problems and build new things. [pause] He played with toys he made himself from scrap materials, [speak with a dreamy tone] dreaming big about helping people in his village."\n    },\n    {\n      "chapter_title": "Mwas\'s Phone",\n      "chapter_text_with_voice_cues": "One day, [speak in a concerned tone] Mwas faced a big problem. [pause] His mother was sick, and there was no way to reach a doctor from the village. [pause] Mwas thought long and hard, wanting to find a solution. [speak slowly and thoughtfully] Then, he did something amazing. [speak with excitement] He took an empty soda bottle, some copper wire, and a piece of cloth. [pause] He made something like a phone, knowing that sound could travel through wires. [speak with determination] He took his bottle phone and went to the home of his neighbor, Old Ali, who knew how to contact the village doctor."\n    },\n    {\n      "chapter_title": "Help from Afar",\n      "chapter_text_with_voice_cues": "Old Ali listened to Mwas carefully. [pause] He understood Mwas\'s problem and connected his bottle phone to another phone made with a long wire. [speak with a sense of wonder] Mwas\'s voice reached the doctor far away, and the doctor promised to come as quickly as possible. [speak with happiness] Mwas was overjoyed, knowing his mother would get help."\n    },\n    {\n      "chapter_title": "The Glory of Creativity",\n      "chapter_text_with_voice_cues": "The doctor arrived in the village quickly and treated Mwas\'s mother. [speak with joy] Mwas was very happy, knowing that he had saved his mother with his intelligence and creativity. [speak with admiration] The villagers praised Mwas for his skills and his amazing mind. [speak with pride] Mwas knew that his creativity had the power to help many people."\n    },\n    {\n      "chapter_title": "Mwas, the Village Inventor",\n      "chapter_text_with_voice_cues": "From that day on, [speak with a sense of accomplishment] Mwas continued to create new things and improve the lives of people in his village. [speak with enthusiasm] He built water tanks using old cans, made solar lights using plastic bottles, and planted many trees to add beauty to his village. [speak with a sense of pride] Mwas was the village inventor, [speak with a sense of purpose] driven by the dream of helping others with his mind and his hands."\n    }\n  ]\n}\n```',
        },
      ],
    },
  ],
});
